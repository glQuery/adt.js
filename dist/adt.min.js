/*
 * adt.js - Algebraic Data Types for JavaScript
 * adt.js is free, public domain software (http://creativecommons.org/publicdomain/zero/1.0/)
 * Originally created by Rehno Lindeque of http://www.mischievousmeerkat.com
 */
var adt = (function() {
"use strict";
var init=function(a,b){var c,d,e;for(c=0;c<b.length;++c){var f=b[c];if(Array.isArray(f))init(a,f);else if(typeof f=="string"||typeof f=="number"){if(f!=="_"&&String(f).charAt(0)==="_")continue;a[f]=makeConstructor(f)}else{if(typeof f!="object"&&typeof f!="function")continue;for(d in f){if(d!=="_"&&d.charAt(0)==="_")continue;typeof f[d]=="function"?a[d]=f[d]:a[d]=function(){return f[d]}}}}},adt=function(){var a={};return init(a,arguments),evaluator(a)},makeConstructor=function(a){return function(){var b=[String(a)].concat([].slice.call(arguments,0));return b._ADTData=!0,b}},unescapeString=function(a){var b,c="",d={"\\":"\\",'"':'"',"'":"'",t:"\t",r:"\r",n:"\n"};for(b=0;b<a.length-1;++b)a[b]!=="\\"?c+=a[b]:(replacement=d[a[b+1]],c+=replacement==null?a[b+1]:replacement,++b);return b===a.length-1?c+a[a.length-1]:c},escapeString=function(a,b){var c,d="",e,b=b||{"\\":"\\\\",'"':'\\"',"'":"\\'","\t":"\\t","\r":"\\r","\n":"\\n"};for(c=0;c<a.length;++c)e=b[a[c]],d+=e==null?a[c]:e;return d},evaluator=function(a){var b,c=function(){return c.eval.apply(d,arguments)},d=Object.create(a);c.eval=function(a){if(typeof a=="string"||typeof a=="number"){var b;return d._key=d._pattern=a,typeof c[a]=="function"?b=c[a].apply(d,[].slice.call(arguments,1)):b=c._.apply(d,[].slice.call(arguments,1)),b}if(Array.isArray(a)&&a._ADTData===!0){var b=new Array(a.length),e="",f;b._ADTData=!0;for(f=1;f<a.length;++f){var g=Array.isArray(a[f])&&a[f]._ADTData===!0?c.eval(a[f]):a[f];Array.isArray(g)&&g._ADTData===!0?(e=e.concat(" ".concat(g[0])),b[f]=g):(e=e.concat(" ".concat(typeof g)),b[f]=g)}return b[0]=a[0],d._key=d._pattern=b[0],c.eval.apply(d,b)}return a};for(b in a)b!=="eval"&&(typeof a[b]=="function"?c[b]=function(b){return function(){return a[b].apply(d,arguments)}}(b):c[b]=function(b){return function(){return a[b]}}(b));return c};adt.constructors=function(a){var b,c=[];if(a!=null)for(b in a)c.push(b);return adt.apply(null,c)},adt.own=function(){var a,b,c,d,e,f={};for(a=0;a<arguments.length;++a){c=arguments[a],d=Object.getOwnPropertyNames(c);for(b=0;b<d.length;++b)e=d[b],f[e]=c[e]}return adt(f)},adt.own.constructors=function(a){var b,c=[];for(b=0;b<arguments.length;++b)c.push(Object.getOwnPropertyNames(arguments[b]));return adt.apply(null,Array.prototype.concat.apply([],c))},adt.deconstruct=function(a){return a&&a._ADTData===!0?{key:a[0],value:a.slice(1)}:{key:typeof a,value:a}},adt.serialize=function(){var a=adt("serialized",{_:function(){var a,b={"\\":"\\\\",'"':'\\"',"'":"\\'","\t":"\\t","\r":"\\r","\n":"\\n"," ":"\\ "},c=escapeString(this._key,b),d;for(a=0;a<arguments.length;++a)d=adt.deconstruct(arguments[a]),c+=" "+(d.key==="string"?'"'+escapeString(d.value)+'"':d.key==="serialized"?"("+d.value+")":String(d.value));return this.serialized(c)}});return String(adt.deconstruct(a.apply(a,arguments)).value)};var eatWhiteSpace=function(a){for(var b=0;b<a.length;++b){switch(a[b]){case" ":case"\n":case"\r":case"\t":continue}return a.slice(b)}return""},lexString=function(a){var b,c=1;for(;;){c=string.indexOf(a[0],c);if(c===-1)throw"No closing quotation mark was found for the string starting with "+a.slice(0,Math.min(5,a.length))+"...";for(b=c-1;b>0;--b)if(a[b]!=="\\"){if(c-b&!0)return{head:a.slice(0,c+1),tail:a.slice(c+1)};break}}},lex=function(a){var b;a=eatWhiteSpace(a);if(a.length===0)return["",""];switch(a[0]){case"(":case")":case'"':case"'":case"[":case"]":case",":return{head:a[0],tail:a.slice(1)}}for(var c=0;c<a.length;++c)switch(a[c]){case"(":case")":case"[":case"]":case",":case" ":case"\n":case"\r":case"\t":return{head:a.slice(0,c),tail:a.slice(c)};case'"':case"'":return lexString(a)}},parseADTTail=function(a,b){},parseArrayTail=function(a,b){if(b.length<2)throw"No closing bracket found for array [..."},parseArg=function(a,b){var c=b[0],d=b.slice(1);if(c.length===0)return d;switch(c){case"(":return d=parseADTTail(a,d),d;case"[":return d=parseArrayTail(a,d),d}switch(c[0]){case'"':return a[a.length-1].push(unescapeString(c.slice(1,c.length-1))),d;case"'":return a[a.length-1].push(unescapeString(c.slice(1,c.length-1))),d}throw"Unexpected token `"+c+"` in data"},parse=function(a){};adt.deserialize=function(a){var b=[],c={head:"",tail:a},d=[];while(c.tail.length>0)c=lex(c.tail),b.push(c.head);while(b.length>0&&b[0].length==0)b=b.slice(1);if(b.length==0)return;if(b[0]==="("){if(b[b.length-1]!==")")throw lexemesStr=b.join(" "),"Optional opening parenthesis used for the data "+lexemesStr.slice(0,Math.min(10,lexemesStr.length))+"... but could not find the closing parenthesis.";switch(b[0][0]){case'"':case"'":case"[":break;default:b=["("].concat(b).concat([")"])}}return parse(b)};  // Export adt to a CommonJS module if exports is available
  if (typeof(exports) !== "undefined" && exports !== null)
    exports.adt = adt;
  return adt;
})();

